<!DOCTYPE html>
<html>
	<head lang="en">
   		<meta charset="utf-8">
   		<title>A node.js WebRtc example</title>
		<script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.0.11.js"></script>
	</head>
	<body>
		<h1 align="center">A node.js WebRtc example</h1>
		<form id="testWebRtc">
			userName: <input type="text" name="userName" disabled><br>
			msgToSendToALLConnections: <input type="text" name="msg" disabled><br><br>
		</form>
			<input type="button" onclick="publishSampleMessage()" value="send message">
			<input type="button" onclick="listAvailableChannels()" value="list channels">
			<input type="button" onclick="createChannel()" value="create channel">
		<p id="event"></p>

		<script>
			pubnub = new PubNub({
						publishKey : 'pub-c-4c1c39f8-813b-4424-9d41-c83b634cad79',
						subscribeKey : 'sub-c-67dc1f0e-829c-11e6-a8c4-0619f8945a4f'
					});
				
			pubnub.addListener({
				status: function(statusEvent) {
					console.log("status message received w/ status", statusEvent);
				},
				message: function(message) {
					console.log("messageReceived:",	message);
					alert(message.message);
				},
				presence: function(presenceEvent) {
					// handle presence
				}
			});
			
			pubnub.subscribe({
					channels: ['test_channel1'],
					withPresence: true
				});
			
			function listAvailableChannels() {
				
				pubnub.channelGroups.listChannels(
					{
						channelGroup: "no_channel_group"
					}, 
					function (status, response) {
						if (status.error) {
							console.log("operation failed w/ error:", status);
							return;
						}
						 
						console.log("listing push channels for this device")
						response.channels.forEach( function (channel) {
							console.log(channel)
						});
					}
				);
			}
			function publishSampleMessage() {
				console.log("Since we're publishing on subscribe connectEvent, we're sure we'll receive the following publish.");
				var publishConfig = {
					channel : "test_channel1",
					message : "Michael says: Hello from the Basic Pubnub tutorial!"
				}
				pubnub.publish(publishConfig, function(status, response) {
					//console.log("Publish a random message",status, response);
				})
			}
			function createChannel() {
				//var form = document.getElementById("testWebRtc");
				//document.getElementById('event').innerHTML = "userName="+form.userName.value+" msg sent="+form.msg.value;
				
				//pubnub.channelGroups.addChannels(
				//	{
				//		channels: ['test_channel1'],
				//		channelGroup: "no_channel_group"
				//	}, 
				//	function(status) {
				//		if (status.error) {
				//			console.log("adding test_channel1 operation failed w/ status: ", status);
				//		} else {
				//			console.log("adding test_channel1 operation done!")
				//		}
				//	}
				//);
				
			}
		</script>
	</body>
</html>